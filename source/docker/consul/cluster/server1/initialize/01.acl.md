# 创建 `Gossip encryption`

## 生成 `encryption`

```shell
consul keygen
7aFF3uN6/oiURrkV8AATXS99XbPC2i7Cj9kNgomeTdE=
```

## 配置 `encryption`

> 配置文件： `/consul/config/consul.json`

```shell
"encrypt": "7aFF3uN6/oiURrkV8AATXS99XbPC2i7Cj9kNgomeTdE=",
```

# 创建 `Bootstrap token`

## 生成 `Bootstrap token`

```shell
consul acl bootstrap
AccessorID:       dac7c5e8-7176-e0a4-7d5b-e1d3ddca8eec
SecretID:         98f11539-2ca2-9679-6ae0-485e89de216f
Description:      Bootstrap Token (Global Management)
Local:            false
Create Time:      2023-02-28 10:26:34.817252613 +0800 CST
Policies:
   00000000-0000-0000-0000-000000000001 - global-management
```

## 配置 `Bootstrap token`

> 配置文件： `/consul/config/consul.json`

```shell
"acl": {
  "enabled": true,
  "default_policy": "deny",
  "enable_token_persistence": true,
  "tokens": {
      "master": "98f11539-2ca2-9679-6ae0-485e89de216f"
  }
}
```

## 查看集群状态

```shell
consul members -token 98f11539-2ca2-9679-6ae0-485e89de216f
```

# 创建 `Agent token`

## 生成 `Agent token`

> 命令提示

```shell
consul acl token create -description "<node-name> agent token" \
  -node-identity "<node-name>:<datacenter-of-node>"
```

> 命令执行

```shell
consul acl token create -description "Agent token for consul-server1" -node-identity "consul-server1:dc1" -token 98f11539-2ca2-9679-6ae0-485e89de216f
AccessorID:       f4d2e708-b043-44e4-a423-b2625e3a72b5
SecretID:         b0de771e-24ef-1606-16a0-35b182e1e5ad
Description:      Agent token for consul-server1
Local:            false
Create Time:      2023-02-28 10:55:31.63705917 +0800 CST
Node Identities:
   consul-server1 (Datacenter: dc1)
```

## 配置 Agent Token

> 配置文件： `/consul/config/consul.json`

```shell
"acl": {
  "enabled": true,
  "default_policy": "deny",
  "enable_token_persistence": true,
  "tokens": {
      "master": "98f11539-2ca2-9679-6ae0-485e89de216f",
      "agent": "b0de771e-24ef-1606-16a0-35b182e1e5ad"
  }
}
```

# 创建 `Service token`

## 生成 `Service token`

> 命令提示

```shell
consul acl token create -description "Token for <service-name>" \
  -service-identity "<service-name>"
```

> 命令执行

```shell
consul acl token create -description "Service token for micro-service" -service-identity "micro-service" -token 98f11539-2ca2-9679-6ae0-485e89de216f
AccessorID:       6e96c4a9-0f01-9d4d-54b4-d50a96799149
SecretID:         816a612e-29a5-8819-68ce-beb2efebc005
Description:      Service token for micro-service
Local:            false
Create Time:      2023-02-28 11:06:05.160999104 +0800 CST
Service Identities:
   micro-service (Datacenters: all)
```